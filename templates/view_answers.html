{% extends "base.html" %}
{% block title %}Hasabatlar formasy{% endblock %}

{% block content %}
<h2 class="text-success mb-4">ðŸ“‹ "{{ form.title }}" boÃ½unÃ§a jogaplar</h2>

<div class="table-responsive">
  <table class="table table-bordered table-striped align-middle">
    <thead class="table-success text-center">
      <tr>
        <th>#</th>
        <th>FamiliÃ½asy ady</th>
        <th>Email</th>
        <th>Wagty</th>
        {% for q in form.questions %}
          <th>{{ q.text }}</th>
        {% endfor %}
        <th>FaÃ½l</th>
        <th>Bellik (habarly et)</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
        {% set answer = answer_objs.get(user.id) %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ user.full_name }}</td>
          <td>{{ user.email }}</td>
          <td>
            {% if answer and answer.updated_at %}
              {{ answer.updated_at | localtime }}
            {% else %}
              â€”
            {% endif %}
          </td>

          {% for q in form.questions %}
            <td>
              {% if answer %}
                {{ answer_map.get(user.id, {}).get(q.id|string, '') }}
              {% else %}
                â€”
              {% endif %}
            </td>
          {% endfor %}

          <td class="text-center">
            {% if answer and answer.filename %}
              <a href="{{ url_for('form_file', filename=answer.filename) }}" target="_blank">ðŸ“Ž</a>
            {% else %}
              â€”
            {% endif %}
          </td>

          <td>
            {% if answer %}
              <form method="post" action="{{ url_for('save_note', answer_id=answer.id) }}" class="d-flex">
                <input type="text" name="note" value="{{ answer.note or '' }}" class="form-control form-control-sm me-1">
                <button class="btn btn-outline-success btn-sm">ðŸ’¾</button>
              </form>
            {% else %}
              <span class="text-muted">Jogap Ã½ok</span>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<a href="{{ url_for('dashboard') }}" class="btn btn-outline-success mt-3">ðŸ”™ Yza â€“ Hasabat sanawyna</a>
{% endblock %}
